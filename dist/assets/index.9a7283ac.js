var L=Object.defineProperty,j=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var S=Object.prototype.hasOwnProperty,k=Object.prototype.propertyIsEnumerable;var _=(s,e,a)=>e in s?L(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a,p=(s,e)=>{for(var a in e||(e={}))S.call(e,a)&&_(s,a,e[a]);if(N)for(var a of N(e))k.call(e,a)&&_(s,a,e[a]);return s},h=(s,e)=>j(s,B(e));var w=(s,e)=>{var a={};for(var o in s)S.call(s,o)&&e.indexOf(o)<0&&(a[o]=s[o]);if(s!=null&&N)for(var o of N(s))e.indexOf(o)<0&&k.call(s,o)&&(a[o]=s[o]);return a};import{r,j as t,a as I,l as $,b as i,L as E,S as P,R as b,c as C,B as U,d as F}from"./vendor.77f5a17b.js";const D=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const u of c.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&o(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerpolicy&&(c.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?c.credentials="include":n.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}};D();const R="http://localhost:3001/api",A=async(s,e,a="GET")=>{const o=`${R}/${s}`;return a=="GET"?await(await fetch(o)).json():await(await fetch(o,{method:a,headers:{"Content-type":"application/json"},body:JSON.stringify(e)})).json()},M=async(s,e={},a="GET")=>{const o=`${R}/${s}`,n=localStorage.getItem("token")||"";return a=="GET"?await(await fetch(o,{headers:{"x-token":n}})).json():await(await fetch(o,{method:a,headers:{"Content-type":"application/json","x-token":n},body:JSON.stringify(e)})).json()},f={loadUsers:"[chat] Users loaded",selectChat:"[chat] Select Chat",newMessage:"[chat] new message",loadMessages:"[chat] load messages",purgeChat:"[chat] purge chat"},v=r.exports.createContext(),G={uid:null,checking:!0,logged:!1,name:null,email:null},J=({children:s})=>{const[e,a]=r.exports.useState(G),o=async(d,l)=>{const m=await A("login",{email:d,password:l},"POST");if(m.ok){localStorage.setItem("token",m.token);const{user:g}=m;a({uid:g._id,checking:!1,logged:!0,name:g.name,email:g.email})}return m.ok},n=async(d,l,m)=>{const g=await A("login/new",{email:d,name:m,password:l},"POST");if(g.ok){localStorage.setItem("token",g.token);const{user:y}=g;a({uid:y._id,checking:!1,logged:!0,name:y.name,email:y.email})}return g.ok},c=r.exports.useCallback(async()=>{if(!localStorage.getItem("token"))return a({uid:null,checking:!1,logged:!1,name:null,email:null}),!1;const l=await M("login/renew");if(l.ok){localStorage.setItem("token",l.token);const{user:m}=l;return a({uid:m._id,checking:!1,logged:!0,name:m.name,email:m.email}),console.log("Authenticated"),!0}else return a({uid:null,checking:!1,logged:!1,name:null,email:null}),!1},[]),u=()=>{localStorage.removeItem("token"),a({checking:!1,logged:!1})};return t(v.Provider,{value:{auth:e,login:o,register:n,verificateToken:c,logout:u},children:s})},q=(s,e)=>{switch(e.type){case f.loadUsers:return h(p({},s),{users:[...e.payload]});case f.selectChat:return s.activeChat===e.payload?s:h(p({},s),{activeChat:e.payload,messages:[]});case f.newMessage:return s.activeChat===e.payload.from||s.activeChat===e.payload.to?h(p({},s),{messages:[...s.messages,e.payload]}):s;case f.loadMessages:return h(p({},s),{messages:[...e.payload]});case f.purgeChat:return{userId:"",activeChat:null,users:[],messages:[]};default:return s}},x=r.exports.createContext(),z={userId:"",activeChat:null,users:[],messages:[]},K=({children:s})=>{const[e,a]=r.exports.useReducer(q,z);return t(x.Provider,{value:{chatState:e,dispatch:a},children:s})},Y=s=>{I.scrollToBottom({containerId:s,duration:0})},H=s=>{I.scrollToBottom({containerId:s,duration:100})},Q=s=>{const[e,a]=r.exports.useState(null),[o,n]=r.exports.useState(!1),c=r.exports.useCallback(()=>{const d=localStorage.getItem("token"),l=$(s,{transports:["websocket"],query:{"x-token":d}});a(l)},[s]),u=r.exports.useCallback(()=>{e==null||e.disconnect()},[e]);return r.exports.useEffect(()=>{n(e==null?void 0:e.connected),e==null||e.on("connect",()=>n(!0)),e==null||e.on("disconnect",()=>n(!1))},[e]),{socket:e,online:o,connectSocket:c,disconnectSocket:u}},T=r.exports.createContext(),V=({children:s})=>{const e="https://chat-socket-io-server.herokuapp.com",{socket:a,online:o,connectSocket:n,disconnectSocket:c}=Q(e),{auth:u}=r.exports.useContext(v),{dispatch:d}=r.exports.useContext(x);return r.exports.useEffect(()=>{u.logged&&n()},[u,n]),r.exports.useEffect(()=>{u.logged||c()},[u,c]),r.exports.useEffect(()=>{a==null||a.on("user-list",l=>{d({type:f.loadUsers,payload:l})})},[a,d]),r.exports.useEffect(()=>{a==null||a.on("personal-message",l=>{d({type:f.newMessage,payload:l}),H("messages")})},[a]),t(T.Provider,{value:{socket:a,online:o},children:s})},W=()=>t("div",{className:"middle-screen",children:i("div",{className:"alert-info",children:[t("hr",{}),t("h3",{children:"Seleccione una persona"}),t("span",{children:"Para iniciar una conversaci\xF3n"})]})}),X=()=>{const{logout:s}=r.exports.useContext(v),{dispatch:e}=r.exports.useContext(x);return i("div",{className:"headind_srch",children:[t("div",{className:"recent_heading mt-2",children:t("h4",{children:"Recientes"})}),t("div",{className:"srch_bar",children:t("div",{className:"stylish-input-group",children:t("button",{onClick:()=>{s(),e({type:f.purgeChat})},className:"btn text-danger",children:"Salir"})})})]})},Z=({name:s,online:e,_id:a})=>{const{chatState:o,dispatch:n}=r.exports.useContext(x);return t("div",{onClick:async()=>{n({type:f.selectChat,payload:a});const u=await M(`messages/${a}`);n({type:f.loadMessages,payload:u.messages}),Y("messages")},className:`chat_list ${a===o.activeChat&&"active_chat"}`,children:i("div",{className:"chat_people",children:[t("div",{className:"chat_img",children:t("img",{src:"https://ptetutorials.com/images/user-profile.png",alt:"sunil"})}),i("div",{className:"chat_ib",children:[t("h5",{children:s}),e?t("span",{className:"text-success",children:"Online"}):t("span",{className:"text-danger",children:"Offline"})]})]})})},ee=()=>{const{chatState:s}=r.exports.useContext(x),{auth:e}=r.exports.useContext(v),{users:a}=s;return i("div",{className:"inbox_chat",children:[a.filter(o=>o._id!==e.uid).map(o=>t(Z,p({},o),o._id)),t("div",{className:"extra_space"})]})},te=()=>i("div",{className:"inbox_people",children:[t(X,{}),t(ee,{})]}),se=({message:s})=>i("div",{className:"incoming_msg",children:[t("div",{className:"incoming_msg_img",children:t("img",{src:"https://ptetutorials.com/images/user-profile.png",alt:"sunil"})}),t("div",{className:"received_msg",children:i("div",{className:"received_withd_msg",children:[t("p",{children:s==null?void 0:s.message}),t("span",{className:"time_date",children:" 11:01 AM | June 9"})]})})]}),ae=({message:s})=>t("div",{className:"outgoing_msg",children:i("div",{className:"sent_msg",children:[t("p",{children:s==null?void 0:s.message}),t("span",{className:"time_date",children:" 11:01 AM | June 9"})]})}),ne=()=>{const{socket:s}=r.exports.useContext(T),{chatState:e}=r.exports.useContext(x),{auth:a}=r.exports.useContext(v);return t("form",{onSubmit:n=>{n.preventDefault();const c=n.target[0].value;c.length!==0&&(s.emit("personal-message",{from:a.uid,to:e.activeChat,message:c}),n.target.reset())},children:i("div",{className:"type_msg row",children:[t("div",{className:"input_msg_write col-sm-9",children:t("input",{type:"text",className:"write_msg",placeholder:"Mensaje..."})}),t("div",{className:"col-sm-3 text-center",children:t("button",{className:"msg_send_btn mt-3",type:"submit",children:"Send"})})]})})},oe=()=>{const{chatState:s}=r.exports.useContext(x),{auth:e}=r.exports.useContext(v);return i("div",{className:"mesgs",children:[t("div",{id:"messages",className:"msg_history",children:s.messages.map(a=>a.to===e.uid?t(se,{message:a},a._id):t(ae,{message:a},a._id))}),t(ne,{})]})};const re=()=>{const{chatState:s}=r.exports.useContext(x);return t("div",{className:"messaging",children:i("div",{className:"inbox_msg",children:[t(te,{}),s.activeChat?t(oe,{}):t(W,{})]})})},O=s=>/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(s),ce=()=>{const{login:s}=r.exports.useContext(v),[e,a]=r.exports.useState({email:"",password:"",rememberme:!1});r.exports.useEffect(()=>{const d=localStorage.getItem("email");d&&a(l=>h(p({},l),{email:d,rememberme:!0}))},[]);const o=({target:d})=>{const{name:l,value:m}=d;a(h(p({},e),{[l]:m}))},n=()=>{a(h(p({},e),{rememberme:!e.rememberme}))},c=async d=>{d.preventDefault(),e.rememberme?localStorage.setItem("email",e.email):localStorage.removeItem("email");const{email:l,password:m}=e;await s(l,m)||Swal.fire({icon:"error",title:"Error al iniciar sesi\xF3n",text:"Credenciales incorrectas"})},u=()=>!!(O(e.email)&&e.password.length>0);return i("form",{onSubmit:c,className:"login100-form validate-form flex-sb flex-w",children:[t("span",{className:"login100-form-title mb-3",children:"Chat"}),i("div",{className:"wrap-input100 validate-input mb-3",children:[t("input",{className:"input100",type:"email",name:"email",placeholder:"Email",value:e.email,onChange:o}),t("span",{className:"focus-input100"})]}),i("div",{className:"wrap-input100 validate-input mb-3",children:[t("input",{className:"input100",type:"password",name:"password",placeholder:"Password",value:e.password,onChange:o}),t("span",{className:"focus-input100"})]}),i("div",{className:"row mb-3",children:[i("div",{className:"col",onClick:()=>n(),children:[t("input",{className:"input-checkbox100",id:"ckb1",type:"checkbox",name:"rememberme",checked:e.rememberme,readOnly:!0}),t("label",{className:"label-checkbox100",children:"Recordarme"})]}),t("div",{className:"col text-right",children:t(E,{to:"/auth/register",className:"txt1",children:"Crear una cuenta"})})]}),t("div",{className:"container-login100-form-btn m-t-17",children:t("button",{disabled:!u(),type:"submit",className:"login100-form-btn",children:"Ingresar"})})]})},le=()=>{const{register:s}=r.exports.useContext(v),[e,a]=r.exports.useState({name:"testUser",email:"test@test.com",password:"123456"}),o=({target:u})=>{const{name:d,value:l}=u;a(h(p({},e),{[d]:l}))},n=()=>!!(O(e.email)&&e.name.length>0&&e.password.length>0);return i("form",{onSubmit:async u=>{u.preventDefault();const{email:d,password:l,name:m}=e;await s(d,l,m)||Swal.fire("Error","Error al crear usuario","error")},className:"login100-form validate-form flex-sb flex-w",children:[t("span",{className:"login100-form-title mb-3",children:"Chat - Registro"}),i("div",{className:"wrap-input100 validate-input mb-3",children:[t("input",{className:"input100",type:"text",name:"name",placeholder:"Nombre",value:e.name,onChange:o}),t("span",{className:"focus-input100"})]}),i("div",{className:"wrap-input100 validate-input mb-3",children:[t("input",{className:"input100",type:"email",name:"email",placeholder:"Email",value:e.email,onChange:o}),t("span",{className:"focus-input100"})]}),i("div",{className:"wrap-input100 validate-input mb-3",children:[t("input",{className:"input100",type:"password",name:"password",placeholder:"Password",value:e.password,onChange:o}),t("span",{className:"focus-input100"})]}),t("div",{className:"row mb-3",children:t("div",{className:"col text-right",children:t(E,{to:"login.html",className:"txt1",children:"Ya tienes cuenta?"})})}),t("div",{className:"container-login100-form-btn m-t-17",children:t("button",{type:"submit",disabled:!n(),className:"login100-form-btn",children:"Crear cuenta"})})]})};const ie=()=>t("div",{className:"limiter",children:t("div",{className:"container-login100",children:t("div",{className:"wrap-login100 p-t-50 p-b-90",children:i(P,{children:[t(b,{exact:!0,path:"/auth/login",component:ce}),t(b,{exact:!0,path:"/auth/register",component:le}),t(C,{to:"/auth/login"})]})})})});const de=o=>{var n=o,{isAuthenticated:s,component:e}=n,a=w(n,["isAuthenticated","component"]);return t(b,h(p({},a),{component:c=>s?t(C,{to:"/"}):t(e,p({},c))}))},ue=o=>{var n=o,{isAuthenticated:s,component:e}=n,a=w(n,["isAuthenticated","component"]);return t(b,h(p({},a),{component:c=>s?t(e,p({},c)):t(C,{to:"/auth/login"})}))},me=()=>{const{auth:s,verificateToken:e}=r.exports.useContext(v);return r.exports.useEffect(()=>{e()},[e]),s.checking?t("h1",{children:"Loading..."}):t(U,{children:t("div",{children:i(P,{children:[t(de,{isAuthenticated:s.logged,path:"/auth",component:ie}),t(ue,{isAuthenticated:s.logged,path:"/",component:re}),t(C,{to:"/"})]})})})},pe=()=>t(J,{children:t(K,{children:t(V,{children:t(me,{})})})});F.render(t(pe,{}),document.getElementById("root"));
